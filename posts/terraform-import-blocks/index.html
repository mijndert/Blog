<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Eleventy v2.0.1">
    <title>Saving time using Terraform import blocks</title>
    <meta name="description" content="Stop creating resources yourself, use import blocks instead. A new feature in Terraform 1.5." />
    <link rel="alternate" type="application/rss+xml" href="https://mijndertstuij.nl/feed.xml" />
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <link rel="stylesheet" href="/css/base.css" />
    <style>@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap')</style>
  </head>
  <body>
    <header>
  <a class="muted" href="/">Mijndert Stuij</a>
</header>
    <main>
      
<h1>Saving time using Terraform import blocks</h1>
<p class="muted">2023.06.15</p>
<article><p>Anyone who uses Terraform must be familiar with the <code>import</code> command; it allows you to gather existing resources and put them into your statefile. This way, existing resources which were previously not created using Terraform are now under management of your infrastructure as code.</p>
<p>You can import your resources in the terminal, but you still have to write the code for the resources you import. With Terraform version 1.5 there's a better solution: import blocks.</p>
<p>Let's take a DigitalOcean Spaces bucket as an example here.</p>
<p>Before <a href="https://www.hashicorp.com/blog/terraform-1-5-brings-config-driven-import-and-checks">Terraform 1.5</a> you first had to import the resource into your statefile:</p>
<pre><code>terraform import digitalocean_spaces_bucket.mybucket `region`,`name`
</code></pre>
<p>Now, using a bit of <code>terraform plan</code> trial and error, you could write the code for the resource until no changes were found anymore.</p>
<pre><code>resource &quot;digitalocean_spaces_bucket&quot; &quot;mybucket&quot; {
  name   = &quot;mybucket&quot;
  region = &quot;ams3&quot;
}
</code></pre>
<p>Using <a href="https://developer.hashicorp.com/terraform/tutorials/state/state-import">import blocks</a> you can basically skip the last step for the most part. You can now import resources using code, and have a basic skeleton of the resource code be created for you.</p>
<p>First we get the DigitalOcean Terraform provider and define our first import block.</p>
<pre><code>terraform {
  required_providers {
    digitalocean = {
      source = &quot;digitalocean/digitalocean&quot;
    }
  }
}

import {
  id = &quot;ams3,mybucket&quot;
  to = digitalocean_spaces_bucket.mybucket
}
</code></pre>
<p>Using <code>terraform plan</code> with the <code>-generate-config-out</code> flag, Terraform will generate configuration for the resource and outputs the plan.</p>
<pre><code>terraform plan -generate-config-out=generated.tf
</code></pre>
<p>Of course, the code it generates isn't perfect, but it's a very good starting point. Now, finally, we don't have to go back and forth between our code and <code>terraform plan</code> to guess the arguments of the resource. You can go ahead and take the output and put it in the correct place in your own codebase.</p>
<p>The above import block will generate something like this:</p>
<pre><code>resource &quot;digitalocean_spaces_bucket&quot; &quot;mybucket&quot; {
  acl           = null
  force_destroy = null
  name          = &quot;mybucket&quot;
  region        = &quot;ams3&quot;
  lifecycle_rule {
    abort_incomplete_multipart_upload_days = 0
    enabled                                = true
    prefix                                 = null
    expiration {
      date                         = null
      days                         = 7
      expired_object_delete_marker = false
    }
    noncurrent_version_expiration {
      days = 7
    }
  }
  versioning {
    enabled = false
  }
}
</code></pre>
</article>
<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none" style="top: 4px;position: relative;">
  <path fill-rule="evenodd" clip-rule="evenodd" d="M13.5706 1.07915L12.9519 0.460419L12.3332 1.07914L8.6363 4.77601L9.87373 6.01345L12.0754 3.8118C12.0758 4.19678 12.0764 4.58119 12.077 4.96525V4.9653V4.96533C12.0799 6.74156 12.0828 8.51005 12.063 10.291C11.9514 12.51 10.2821 14.5766 8.13549 15.0249L8.12156 15.0278L8.10773 15.0311C6.21947 15.49 4.06987 14.5395 3.24835 12.8164L3.24176 12.8025L3.23468 12.7889C2.46106 11.3026 2.86462 9.29521 4.17623 8.31823L4.18926 8.30852L4.20193 8.29834C5.33152 7.3898 7.12207 7.44889 8.09598 8.45611L8.10921 8.46979L8.12302 8.48289C8.65152 8.9839 8.85928 9.70255 8.85928 10.7436V10.8568H10.6093V10.7436C10.6093 9.51128 10.3691 8.21034 9.34085 7.22607C7.68339 5.5272 4.88287 5.51577 3.11789 6.92446C1.07968 8.45342 0.548175 11.4013 1.67527 13.5832C2.88159 16.0953 5.88263 17.3657 8.50709 16.735C11.4878 16.1053 13.6724 13.3174 13.8118 10.3583L13.8126 10.3426L13.8127 10.3269C13.8328 8.53249 13.8299 6.73532 13.827 4.94338V4.9431V4.94298C13.8264 4.56468 13.8258 4.18661 13.8254 3.80885L16.03 6.01344L17.2674 4.77602L13.5706 1.07915Z" fill="currentColor"></path>
</svg>
<a href="https://shareopenly.org/share/?url=https://mijndertstuij.nl/posts/terraform-import-blocks/&text=Saving time using Terraform import blocks" title="Share this post via ShareOpenly!">Share this post via ShareOpenly</a>

    </main>
    <footer>
  <hr>
  <p class="muted">Receive updates</p>
  <p>Follow me via <a href="/feed.xml">RSS</a> or <a href="/contact">other options</a>.</p>
</footer>
  </body>
</html>
