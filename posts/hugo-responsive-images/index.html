<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Eleventy v2.0.1">
    <title>Responsive images on a static Hugo website</title>
    <meta name="description" content="Serving optimized responsive images using Hugo" />
    <link rel="alternate" type="application/rss+xml" href="https://mijndertstuij.nl/feed.xml" />
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="manifest" href="favicon/site.webmanifest">
    <link rel="stylesheet" href="/css/base.css" />
    <style>@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:ital,wght@0,100..800;1,100..800&display=swap')</style>
  </head>
  <body>
    <header>
  <a class="muted" href="/">Mijndert Stuij</a>
</header>
    <main>
      
<h1>Responsive images on a static Hugo website</h1>
<p class="muted">2022.12.06</p>
<article><p>For years and years I've been using <a href="https://jekyllrb.com/">Jekyll</a> as my static site generator of choice, mostly because I like their templating engine and I'm a fan of Ruby as a programming language. I've been experimenting with Hugo as well, but it never really clicked for me. Well, until I found <a href="https://github.com/mavidser/hugo-rocinante">the perfect theme</a> for my needs. The same theme is now used here and on the <a href="https://blog.toot.community/">toot.community blog</a> so I wanted to set mine apart a little bit by adding banner images on some posts. Downloading an image from Unsplash and manually resizing it wasn't an option though - I need things to be frictionless when I want to add a blog entry.</p>
<p>I started looking for ways to automatically generate multiple sizes of an image and came across a lot of different solutions. Most didn't work anymore or were very convoluted. That's to say, until I found <a href="https://www.brycewray.com/posts/2022/06/responsive-optimized-images-hugo/">Bryce Wray's entry</a>.</p>
<p>I quickly adapted his code to my needs and had it working on no-time, you can see it in action <a href="/posts/scaling-mastodon-community/">right here</a>.</p>
<p>Here's how I did it.</p>
<h2>Assets directory</h2>
<p>In order to leverage the built-in image resizing capabilities of Hugo, you have to create an <code>assets/images</code> directory in the root of your project. Any other place doesn't work, unless of course you customize the directory. But I like using defaults to avoid breakage later down the line.</p>
<h2>Shortcodes</h2>
<p>The following Hugo shortcode will generate multiple sizes of a given image and spit out .webp and .jpeg files.</p>
<p>Create a file called <code>/layouts/shortcodes/imgh.html</code> in the root of your project with the following contents.</p>
<pre><code>{{- $respSizes := slice &quot;960&quot; &quot;1280&quot; &quot;1920&quot; -}}
{{- $imgBase := &quot;images/&quot; -}}
{{- $src := resources.Get (printf &quot;%s%s&quot; $imgBase (.Get &quot;src&quot;)) -}}
{{- $alt := .Get &quot;alt&quot; -}}
{{- $divClass := &quot;&quot; -}}{{/* Init'g */}}
{{- $imgClass := &quot;w-full h-auto animate-fade&quot; -}}
{{- $dataSzes := &quot;(min-width: 1024px) 100vw, 50vw&quot; -}}
{{- $actualImg := $src.Resize &quot;640x jpg&quot; -}}
&lt;picture&gt;
  &lt;source
    type=&quot;image/webp&quot;
    srcset=&quot;
      {{- with $respSizes -}}
        {{- range $i, $e := . -}}
        {{- if ge $src.Width . -}}
          {{- if $i }}, {{ end -}}{{- ($src.Resize (printf &quot;%sx%s&quot; . &quot; webp&quot;) ).RelPermalink }} {{ . }}w
        {{- end -}}
      {{- end -}}
    {{- end -}}&quot;
    sizes=&quot;{{ $dataSzes }}&quot;
  /&gt;
  &lt;source
    type=&quot;image/jpeg&quot;
    srcset=&quot;
      {{- with $respSizes -}}
        {{- range $i, $e := . -}}
          {{- if ge $src.Width . -}}
            {{- if $i }}, {{ end -}}{{- ($src.Resize (printf &quot;%sx%s&quot; . &quot; jpg&quot;) ).RelPermalink }} {{ . }}w
          {{- end -}}
      {{- end -}}
    {{- end -}}&quot;\
    sizes=&quot;{{ $dataSzes }}&quot;
  /&gt;
  &lt;img class=&quot;{{ $imgClass }}&quot;
    src=&quot;{{ $actualImg.RelPermalink }}&quot;
    width=&quot;{{ $src.Width }}&quot;
    height=&quot;{{ $src.Height }}&quot;
    alt=&quot;{{ $alt }}&quot;
    loading=&quot;lazy&quot;
  /&gt;
&lt;/picture&gt;
&lt;/div&gt;
</code></pre>
<h2>Using the shortcode</h2>
<p>Now in order to use the above shortcode you can simply drop an image into <code>/assets/images</code> and insert this line of code in your MarkDown file.</p>
<pre><code>{{&lt;/* imgh src=&quot;my-example-file.jpeg&quot; alt=&quot;My example file&quot; */&gt;}}
</code></pre>
</article>

    </main>
    <footer>
  <hr>
  <p class="muted">Receive updates</p>
  <p>Follow me via <a href="/feed.xml">RSS</a> or <a href="/contact">other options</a>.</p>
</footer>
  </body>
</html>
